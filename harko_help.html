<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Harko-Patterson - Technical Guide</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Source+Code+Pro:wght@400;600&display=swap" rel="stylesheet">
    <script>
        MathJax = {
          tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
          },
          svg: {
            fontCache: 'global'
          }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
    </script>
    <style>
        :root {
            --dark-bg: #111827;
            --medium-bg: #1f2937;
            --light-bg: #374151;
            --border-color: #4b5563;
            --primary-accent: #3b82f6;
            --text-light: #f3f4f6;
            --text-medium: #d1d5db;
            --text-dark: #9ca3af;
            --content-bg: #ffffff;
            --content-text: #1f2937;
            --content-heading: #111827;
            --code-bg: #f3f4f6;
            --code-text: #111827;
        }
        body {
            font-family: 'Inter', sans-serif; margin: 0; background-color: var(--content-bg);
            color: var(--content-text); line-height: 1.7; display: flex;
            height: 100vh; overflow: hidden;
        }
        #left-panel {
            width: 280px; flex-shrink: 0; background-color: var(--dark-bg);
            color: var(--text-medium); padding: 2rem; overflow-y: auto;
            border-right: 1px solid var(--border-color);
        }
        #left-panel .logo {
            font-size: 1.5rem; font-weight: 700; color: var(--text-light);
            margin-bottom: 2rem;
        }
        #left-panel .logo span { color: var(--primary-accent); }
        #toc { list-style: none; padding: 0; margin: 0; }
        #toc li a {
            display: block; color: var(--text-dark); text-decoration: none;
            padding: 0.6rem 1rem; border-radius: 0.375rem; font-weight: 500;
            font-size: 0.9rem; transition: background-color 0.2s, color 0.2s;
            border-left: 3px solid transparent;
        }
        #toc li a:hover { background-color: var(--medium-bg); color: var(--text-light); }
        #toc li a.active {
            background-color: var(--light-bg); color: var(--text-light);
            border-left-color: var(--primary-accent); font-weight: 600;
        }
        #main-content { flex-grow: 1; overflow-y: auto; padding: 3rem 4rem; }
        section {
            margin-bottom: 4rem; padding-top: 2rem; border-top: 1px solid #e5e7eb;
        }
        section:first-child { padding-top: 0; border-top: none; }
        h1, h2, h3, h4 {
            color: var(--content-heading); font-weight: 700; line-height: 1.3;
            margin-top: 1.5em; margin-bottom: 1em;
        }
        h1 { font-size: 2.5rem; }
        h2 { font-size: 2rem; border-bottom: 1px solid #e5e7eb; padding-bottom: 0.5rem; }
        h3 { font-size: 1.5rem; }
        h4 { font-size: 1.2rem; }
        p, li { margin-bottom: 1rem; }
        ul, ol { padding-left: 1.5rem; }
        a { color: var(--primary-accent); text-decoration: none; font-weight: 500; }
        a:hover { text-decoration: underline; }
        code {
            font-family: 'Source Code Pro', monospace; background-color: var(--code-bg);
            color: var(--code-text); padding: 0.2em 0.4em;
            border-radius: 0.25rem; font-size: 0.9em;
        }
        pre {
            background-color: var(--code-bg); border-radius: 0.5rem; padding: 1rem;
            overflow-x: auto; font-size: 0.85rem; line-height: 1.5;
        }
        pre code { padding: 0; background: none; }
        blockquote {
            margin-left: 0; padding: 1rem 1.5rem; border-left: 4px solid var(--primary-accent);
            background-color: #f9fafb; color: #4b5563;
        }
        blockquote strong {
            display: block; margin-bottom: 0.5rem; font-weight: 600; color: #111827;
        }
        table {
            width: 100%; border-collapse: collapse; margin-bottom: 1.5rem; font-size: 0.9rem;
        }
        th, td { padding: 0.75rem 1rem; border: 1px solid #d1d5db; text-align: left; }
        th { background-color: #f3f4f6; font-weight: 600; }
        .footer {
            text-align: center; margin-top: 4rem; padding-top: 2rem;
            border-top: 1px solid #e5e7eb; font-size: 0.85rem; color: #6b7280;
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #aaa; }
    </style>
</head>
<body>
    <aside id="left-panel">
        <div class="logo">Help Guide: <span>Harko</span></div>
        <nav>
            <ul id="toc">
                <li><a href="#introduction" class="active">Intro: Patterson Maps</a></li>
                <li><a href="#harker-sections">Harker Sections Explained</a></li>
                <li><a href="#program-overview">Program Overview & UI</a></li>
                <li><a href="#data-input">Data Input Format</a></li>
                <li><a href="#calculation-method">Calculation Methodology</a></li>
                <li><a href="#analysis-workflow">Analysis & Workflow</a></li>
                <li><a href="#troubleshooting">Troubleshooting</a></li>
                <li><a href="#references">References</a></li>
            </ul>
        </nav>
    </aside>

    <main id="main-content">
        <section id="introduction">
            <h1>Introduction: The Patterson Function</h1>
            <p>
                In crystallography, the "phase problem" prevents a direct calculation of the crystal structure (electron density, $\rho(x,y,z)$) from the measured diffraction intensities ($I_{hkl}$). The Patterson function, or Patterson map, is a powerful tool to overcome this, especially when a heavy atom is present in the structure (the "heavy-atom method").
            </p>
            <p>
                A Patterson map is a Fourier transform of the intensities ($I_{hkl} \propto |F_{hkl}|^2$) rather than the structure factors ($F_{hkl}$), which contain the unknown phases. The formula is:
            </p>
            $$ P(u, v, w) = \frac{1}{V} \sum_{h} \sum_{k} \sum_{l} |F_{hkl}|^2 \cos(2\pi(hu + kv + lw)) $$
            
            <h3>What do Patterson peaks mean?</h3>
            <p>
                The peaks in a Patterson map do <strong>not</strong> represent atom positions. Instead, they represent <strong>interatomic vectors</strong>.
            </p>
            <p>
                If you have two atoms in the unit cell, atom $i$ at $(x_i, y_i, z_i)$ and atom $j$ at $(x_j, y_j, z_j)$, the Patterson map will show a peak at:
            </p>
            $$ (u, v, w) = (x_i - x_j, \;\; y_i - y_j, \;\; z_i - z_j) $$
            <p>
                The height of this peak is proportional to the product of the atomic numbers of the two atoms: $Z_i \cdot Z_j$.
            </p>
            
            <blockquote>
                <strong>Key Concept: The Heavy Atom Method</strong><br>
                Because peak height is proportional to $Z_i \cdot Z_j$, vectors between heavy atoms (e.g., U-U, $Z=92$) will be vastly stronger than all other vectors (e.g., U-C or C-C). The Patterson map of a heavy-atom compound will be dominated by these few, very strong "heavy-atom vector" peaks.
                <br><br>
                If we can find the positions of these peaks, we can deduce the positions of the heavy atoms. This solves the phase problem and allows for the rest of the structure to be found.
            </blockquote>

            <ul>
                <li><strong>Origin Peak:</strong> The map always has a very large peak at $(0, 0, 0)$. This represents all the "self-vectors" where $i=j$. It contains no useful information and is ignored.</li>
                <li><strong>Centrosymmetry:</strong> The map is always centrosymmetric, even if the crystal structure is not.</li>
            </ul>
        </section>

        <section id="harker-sections">
            <h2>Harker Sections Explained</h2>
            <p>
                If a unit cell contains only one heavy atom in the asymmetric unit, the space group's symmetry operations will generate a set of equivalent atoms. The vectors <em>between</em> these symmetrically-related atoms are special.
            </p>
            <p>
                These "Harker vectors" are not randomly distributed throughout the 3D Patterson map. They are constrained to lie on specific <strong>planes</strong> or <strong>lines</strong>, which are known as <strong>Harker sections</strong>.
            </p>
            <p>
                Finding strong peaks on these known sections allows us to solve for the coordinates of the original heavy atom.
            </p>

            <h3>Example: A 2-fold screw axis ($2_1$)</h3>
            <p>
                A $2_1$ axis parallel to $c$ has the symmetry operation: $(x, y, z) \rightarrow (-x, -y, z + 1/2)$.
            </p>
            <p>
                The interatomic vector (Harker vector) between the original atom and its symmetric equivalent is:
            </p>
            <ul>
                <li>$u = x - (-x) = 2x$</li>
                <li>$v = y - (-y) = 2y$</li>
                <li>$w = z - (z + 1/2) = -1/2 \equiv 1/2$ (in fractional coordinates)</li>
            </ul>
            <p>
                This vector is $(2x, 2y, 1/2)$. Notice that the $w$ coordinate is <strong>fixed at 1/2</strong>, regardless of the original atom's coordinates. This means all such vectors will lie on the <strong>Harker plane at $w=1/2$</strong>.
            </p>
            <p>
                If we find a strong peak on this plane at $(u=0.6, v=0.4, w=0.5)$, we can solve for the atom's $x$ and $y$ coordinates:
            </p>
            <ul>
                <li>$2x = 0.6 \implies x = 0.3$</li>
                <li>$2y = 0.4 \implies y = 0.2$</li>
            </ul>
            <p>
                Just by finding this one peak, we have determined $(x=0.3, y=0.2, z=?)$. The $z$ coordinate is unknown.
            </p>
            
            <h3>Example: A glide plane ($c$)</h3>
            <p>
                A $c$-glide plane perpendicular to $b$ has the operation: $(x, y, z) \rightarrow (x, -y, z + 1/2)$.
            </p>
            <p>
                The Harker vector is: $(x-x, \;\; y-(-y), \;\; z-(z+1/2)) = (0, 2y, -1/2) \equiv (0, 2y, 1/2)$.
            </p>
            <p>
                These vectors lie on the <strong>Harker line at $u=0, w=1/2$</strong>. If we find a peak at $(0, 0.4, 0.5)$, we can solve for $y$:
            </p>
            <ul>
                <li>$2y = 0.4 \implies y = 0.2$</li>
            </ul>
            <p>
                This gives us the partial coordinates $(x=?, y=0.2, z=?)$.
            </p>
            <p>
                By combining information from multiple Harker sections (e.g., from a $2_1$ axis <em>and</em> a $c$-glide), we can find all three coordinates $(x, y, z)$. This is the primary goal of the <strong>Harko</strong> program.
            </p>
        </section>

        <section id="program-overview">
            <h2>Program Overview & UI</h2>
            <p>
                The <strong>Harko</strong> program is a specialized tool designed to automate the Harker method. It is <em>not</em> a full structure solution package. Its purpose is mostly for teaching courses in my classes at Université Paris-Saclay. This program can:
            </p>
            <ol>
                <li>Calculate the 3D Patterson map from an input file of reflection intensities.</li>
                <li>Automatically find peaks on the known Harker sections for the given space group.</li>
                <li>Attempt to combine these partial solutions to find a single, complete heavy atom site.</li>
            </ol>
            
            <h3>The User Interface</h3>
            <p>The application is split into the Controls Panel (left) and the Results Area (right).</p>
            
            <h4>Controls Panel</h4>
            <ul>
                <li><strong>Select Data File:</strong> Button to load your input file. This is the first and most important step.</li>
                <li><strong>Map Tab:</strong>
                    <ul>
                        <li><strong>Crystal & Refinement Data:</strong> Displays the cell, space group, and reflection count parsed from your file.</li>
                        <li><strong>Map Resolution:</strong> Controls the grid size of the 3D Patterson map (e.g., $50 \times 50 \times 50$). Higher values are more accurate but much slower to calculate.</li>
                        <li><strong>Calculate 3D Map & Analyze:</strong> Starts the full analysis pipeline.</li>
                    </ul>
                </li>
                <li><strong>Slices Tab:</strong>
                    <ul>
                        <li>Becomes active after calculation.</li>
                        <li><strong>Slice Sliders (U, V, W):</strong> Allow you to manually move through the 3D Patterson map one slice at a time. The 2D slice is shown in the results area.</li>
                    </ul>
                </li>
                <li><strong>Peaks Tab:</strong>
                    <ul>
                        <li>Becomes active after calculation.</li>
                        <li><strong>Combination Tolerance:</strong> A crucial slider for combining partial solutions. See the <a href="#analysis-workflow">Analysis & Workflow</a> section.</li>
                        <li><strong>Proposed Heavy Atom Sites (Partial):</strong> A table listing all partial solutions found from all Harker sections.</li>
                    </ul>
                </li>
            </ul>

            <h4>Results Area</h4>
            <ul>
                <li><strong>Patterson Map Slice:</strong> A 2D false-color plot of the map at the position selected by the `Slices` tab sliders.</li>
                <li><strong>Found Patterson Peaks:</strong> A table of the 50 strongest peaks found <em>anywhere</em> in the 3D map, sorted by height. This is for general inspection.</li>
                <li><strong>Consolidated Heavy Atom Sites:</strong> The <strong>most important table</strong>. This shows the program's final, combined $(x, y, z)$ coordinates for the heavy atom. This is your answer.</li>
            </ul>
        </section>
        
        <section id="data-input">
            <h2>Data Input Format</h2>
            <p>
                The program requires a plain text file (<code>.dat</code>, <code>.txt</code>) that is typically the output of a Pawley or Le Bail refinement from a program like Powder5. Files obtained by GSAS, FullProf, etc. could also be read, if minor changes are made to the datafiles.
            </p>
            <p>
                The parser is designed to find three specific pieces of information. Your file <strong>must</strong> contain:
            </p>
            
            <h4>1. Space Group</h4>
            <p>A line identifying the space group number and/or name. The parser looks for a line like:</p>
            <pre><code>Space Group:  14  - P21/c</code></pre>

            <h4>2. Unit Cell Parameters</h4>
            <p>Lines defining the lattice parameters. The parser is flexible and looks for patterns like:</p>
            <pre><code>a (A)       10.1234(5)
b (A)       8.4567(3)
c (A)       12.5555(6)
alpha (deg) 90.0
beta (deg)  101.23(1)
gamma (deg) 90.0
</code></pre>
            
            <h4>3. Reflection List</h4>
            <p>
                This is the most critical part. The program needs a list of reflections with their corresponding intensities. The parser looks for a section of text containing lines like:
            </p>
            <pre><code>(   0,   0,   1)     20.450      1500.00
(   1,   0,  -1)     22.120      10000.00
(   1,   0,   0)     23.500      5432.10
...
</code></pre>
            <p>
                The program specifically reads the $(h, k, l)$ values and the <strong>last</strong> number in the line, which it assumes is the intensity ($I_{hkl}$) to be used as $|F_{hkl}|^2$.
            </p>

            <hr style="margin: 2rem 0;">

            <h3>The <code>space_groups_harker.json</code> File</h3>
            <p>
                This program is <strong>not</strong> hard-coded with the Harker section definitions. It reads them from a file named <code>space_groups_harker.json</code>, which must be in the same directory.
            </p>
            <p>
                This JSON file contains an entry for each space group, defining its Harker sections and, most importantly, the "solver" equations.
            </p>
            <p>A sample entry for $P2_1$ (No. 4) might look like this:</p>
            <pre><code>"4": {
    "name": "P 21",
    "harker_sections": [
        {
            "type": "screw",
            "coordinate": "v",
            "value": 0.5,
            "solver": { "x": "u/2", "y": "?", "z": "w/2" }
        }
    ]
}</code></pre>
            <p>This tells the program: "For space group 4, look for peaks on the plane $v=0.5$. If you find one at $(u_0, 0.5, w_0)$, the partial atom site is $(x = u_0/2, y = ?, z = w_0/2)$."</p>
        </section>

        <section id="calculation-method">
            <h2>Calculation Methodology</h2>
            <p>When you click <code>Calculate 3D Map & Analyze</code>, the program executes a precise sequence of operations.</p>
            
            <h3>1. 3D Patterson Map Calculation</h3>
            <p>
                The program allocates a 3D grid of size $N \times N \times N$, where $N$ is the <code>Map Resolution</code>. It then loops through every grid point $(i, j, k)$ and calculates the Patterson function $P(u, v, w)$ using the direct summation formula:
            </p>
            $$ P(u, v, w) = \frac{1}{V} \sum_{h,k,l} I_{hkl} \cdot \cos(2\pi(hu + kv + lw)) $$
            <p>
                Where:
            </p>
            <ul>
                <li>$(u, v, w) = (i/N, j/N, k/N)$ are the fractional coordinates of the grid point.</li>
                <li>$I_{hkl}$ is the intensity for the $(hkl)$ reflection from your input file.</li>
                <li>$V$ is the unit cell volume.</li>
            </ul>
            <p>This 3D array of floating-point numbers is the full Patterson map.</p>

            <h3>2. 3D Peak Search</h3>
            <p>
                Next, the program performs a simple 3D peak search on the calculated map.
            </p>
            <ol>
                <li>It finds the minimum and maximum values in the entire 3D map.</li>
                <li>It sets a detection threshold (e.g., 15% above the minimum).</li>
                <li>It iterates through every point in the map. A point is considered a "peak" if it is a <strong>local maximum</strong> (i.e., its value is greater than all 26 of its immediate neighbors) and is above the threshold.</li>
                <li>All found peaks are sorted by height, and the <strong>top 50 strongest peaks</strong> are saved. These are displayed in the `Found Patterson Peaks` table.</li>
            </ol>
            
            <h3>3. Harker Section Analysis</h3>
            <p>
                This is the core logic. The program now attempts to find the partial atomic coordinates.
            </p>
            <ol>
                <li>It looks up the space group (e.g., "14") in the loaded <code>space_groups_harker.json</code> data.</li>
                <li>It gets the list of all defined Harker sections for that space group.</li>
                <li>It loops through each of the 50 peaks found in Step 2.</li>
                <li>For <strong>each peak</strong>, it loops through <strong>each Harker section definition</strong>.</li>
                <li>It checks if the peak's coordinate matches the section's definition within a small tolerance (typically $1.5 \times$ the grid spacing).</li>
                <li>
                    <strong>Example:</strong>
                    <ul>
                        <li>A peak is at $(u=0.602, v=0.401, w=0.501)$.</li>
                        <li>A Harker definition exists for a $2_1$ screw axis: <code>{ coordinate: "w", value: 0.5, ... }</code>.</li>
                        <li>The program sees that $w=0.501$ is very close to $0.5$. This is a match.</li>
                    </ul>
                </li>
                <li>
                    <strong>Solving:</strong>
                    <ul>
                        <li>The program retrieves the "solver" for that matched section, e.g., <code>{ "x": "u/2", "y": "v/2", "z": "?" }</code>.</li>
                        <li>It executes these equations using the peak's coordinates:
                            <ul>
                                <li>$x = u/2 = 0.602 / 2 = 0.301$</li>
                                <li>$y = v/2 = 0.401 / 2 = 0.2005$</li>
                                <li>$z = ?$</li>
                            </ul>
                        </li>
                        <li>This partial solution <code>(x=0.301, y=0.201, z=?)</code> is added to the <code>Proposed Heavy Atom Sites (Partial)</code> table.</li>
                    </ul>
                </li>
            </ol>
        </section>

        <section id="analysis-workflow">
            <h2>Analysis & Workflow: Site Consolidation</h2>
            <p>
                After the calculation, you will have a list of <em>partial</em> sites in the `Peaks` tab. The final step, <strong>Site Consolidation</strong>, is to automatically combine these partial solutions to find a single, complete $(x, y, z)$ coordinate.
            </p>
            
            <h3>The Consolidation Algorithm</h3>
            <p>
                The program iterates through all possible pairs of partial sites, looking for a logical combination.
            </p>
            
            <p><strong>Imagine this scenario:</strong></p>
            <p>The program found two partial sites for space group $P2_1/c$:</p>
            <ol>
                <li>From the $2_1$ screw axis: <code>(x=0.301, y=?, z=0.449)</code></li>
                <li>From the $c$-glide plane: <code>(x=0.302, y=0.125, z=?)</code></li>
            </ol>
            
            <p>
                The algorithm compares these two sites. It checks if the <em>defined</em> coordinates are close to each other.
            </p>
            <ul>
                <li>Is $x_1 \approx x_2$? Yes: $0.301 \approx 0.302$ (within tolerance).</li>
                <li>Is $z_1 \approx z_2$? No: $z_1=0.449$ but $z_2$ is unknown.</li>
                <li>Is $y_1 \approx y_2$? No: $y_1$ is unknown but $y_2=0.125$.</li>
            </ul>
            
            <p>
                Because they share a common coordinate ($x$), the program "merges" or "consolidates" them into one complete site, taking the defined part from each:
            </p>
            <p>
                <strong>Final Site: `(x=0.301, y=0.125, z=0.449)`</strong> (using the average for $x$)
            </p>
            <p>
                This final, complete site is then added to the <strong>`Consolidated Heavy Atom Sites`</strong> table. This is the program's primary result.
            </p>
            
            <h3>Using the <code>Combination Tolerance</code> Slider</h3>
            <p>
                What if the partial sites were:
            </p>
            <ol>
                <li><code>(x=0.301, y=?, z=0.449)</code></li>
                <li><code>(x=0.330, y=0.125, z=?)</code></li>
            </ol>
            <p>
                Here, $x_1$ and $x_2$ are not very close. The default tolerance (e.g., 0.03) might be too small, and the algorithm would <strong>fail</strong> to combine them.
            </p>
            <p>
                By moving the <strong><code>Combination Tolerance</code></strong> slider up to, say, 0.04, you are telling the algorithm: "It's okay, 0.301 and 0.330 are close enough. Combine them."
            </p>
            <p>
                This slider directly controls the final consolidation step, and moving it will re-run the analysis <em>without</em> re-calculating the 3D map.
            </p>

            <hr style="margin: 2rem 0;">
            
            <h3>Recommended Workflow</h3>
            <ol>
                <li>Load your data file.</li>
                <li>Press <code>Calculate 3D Map & Analyze</code>.</li>
                <li>
                    Look <strong>first</strong> at the <strong>`Consolidated Heavy Atom Sites`</strong> table.
                </li>
                <li>
                    <strong>If sites are present:</strong> Congratulations. These are your most likely heavy atom coordinates.
                </li>
                <li>
                    <strong>If no sites are present:</strong>
                    <ul>
                        <li>Go to the <strong>`Peaks`</strong> tab.</li>
                        <li>Look at the <strong>`Proposed Heavy Atom Sites (Partial)`</strong> table. Are there entries here?</li>
                        <li>If YES, slowly increase the <strong><code>Combination Tolerance</code></strong> slider and see if any consolidated sites appear.</li>
                        <li>If NO (even the partial list is empty), go to <a href="#troubleshooting">Troubleshooting</a>.</li>
                    </ul>
                </li>
                <li>
                    <strong>(Optional)</strong> Go to the <strong>`Slices`</strong> tab and use the sliders to manually explore the map. Look at the Harker sections (e.g., $w=0.5$) to visually confirm if strong peaks are present.
                </li>
            </ol>
        </section>

        <section id="troubleshooting">
            <h2>Troubleshooting & FAQ</h2>

            <h4>Error on load: "Could not parse Space Group" or "Could not determine cell parameters".</h4>
            <ul>
                <li>Your input file is missing this information or it is in a format the program cannot read. Manually edit the <code>.dat</code> file to include lines like <code>Space Group: 14</code> and <code>a (A) 10.123</code>.</li>
            </ul>

            <h4>No peaks found / Map is blank.</h4>
            <ul>
                <li>This most likely means the parser failed to read your <strong>reflection list</strong>. Check that your file has a list of $(hkl)$s and intensities.</li>
                <li>It's also possible all your intensities are zero or the data is extremely poor.</li>
            </ul>
            
            <h4>"No matching Harker peaks found" or "Partial Sites" table is empty.</h4>
            <ul>
                <li><strong>Most likely cause:</strong> The heavy atom is in a "special position" (e.g., on a center of symmetry, or on the rotation axis itself). In these cases, some or all Harker vectors become zero-vectors (piling up at the origin) and cannot be found.</li>
                <li>The wrong space group was assigned.</li>
                <li>The <code>space_groups_harker.json</code> file is missing, or it has no entries for your space group.</li>
            </ul>
            
            <h4>"Partial sites found, but no pairs combined" / "Consolidated Sites" table is empty.</h4>
            <ul>
                <li>This is the most common scenario. The program is finding partial solutions, but they don't agree.</li>
                <li><strong>Solution 1:</strong> Slowly increase the <strong><code>Combination Tolerance</code></strong>. The coordinates may be just outside the default tolerance.</li>
                <li><strong>Solution 2:</strong> Look at the partial sites manually. You may be able to spot the correct combination yourself. For example, if you see <code>(x=0.2, y=?, z=0.4)</code> and <code>(x=?, y=0.1, z=0.9)</code>, they don't combine. But if you also see <code>(x=0.2, y=0.1, z=?)</code>, you can manually combine all three to get <code>(0.2, 0.1, 0.4)</code> (since $z=0.9$ is equivalent to $z=-0.1$, which is different from $0.4$).</li>
                <li><strong>Solution 3:</strong> There may be two heavy atoms, which complicates the Patterson map beyond what this simple program can auto-solve.</li>
            </ul>
        </section>

        <section id="references">
            <h2>References</h2>
            <ol>
                <li>
                    <strong>Original Patterson Paper:</strong><br>
                    Patterson, A. L. (1934). "A Fourier Series Method for the Determination of the Components of Interatomic Distances in Crystals". <em>Physical Review</em>, <strong>46</strong>, 372–376.
                </li>
                <li>
                    <strong>Original Harker Paper:</strong><br>
                    Harker, D. (1936). "The Application of the Three-Dimensional Patterson Method and the Crystal Structures of Proustite, Ag3AsS3, and Pyrargyrite, Ag3SbS3". <em>Journal of Chemical Physics</em>, <strong>4</strong>, 381–390.
                </li>
                <li>
                    <strong>General Crystallography Text:</strong><br>
                    Giacovazzo, C. (ed.) (2011). <em>Fundamentals of Crystallography</em>. 3rd ed. Oxford: Oxford University Press.
                </li>
                <li>
                    <strong>International Tables for Crystallography:</strong><br>
                    Volume A: Space-Group Symmetry. (Contains the definitive list of symmetry operations).
                </li>
            </ol>
            <div class="footer">
                <p>Help Guide created on 26 Oct 2025 by an AI assistant.</p>
            </div>
        </section>

    </main>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const sections = document.querySelectorAll('section');
        const navLinks = document.querySelectorAll('#toc a');
        const mainContent = document.getElementById('main-content');

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.getAttribute('id');
                    navLinks.forEach(link => link.classList.remove('active'));
                    const activeLink = document.querySelector(`#toc a[href="#${id}"]`);
                    if (activeLink) activeLink.classList.add('active');
                }
            });
        }, { root: mainContent, rootMargin: "0px 0px -80% 0px" });

        sections.forEach(section => observer.observe(section));

        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                navLinks.forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                const targetId = this.getAttribute('href');
                const targetElement = document.querySelector(targetId);

                if (targetElement) {
                    mainContent.scrollTo({
                        top: targetElement.offsetTop - 32,
                        behavior: 'smooth'
                    });
                }
            });
        });

        const updateActiveLink = () => {
            let currentActive = '';
            sections.forEach(section => {
                const rect = section.getBoundingClientRect();
                if (rect.top >= 0 && rect.top <= mainContent.clientHeight * 0.2) {
                    currentActive = section.getAttribute('id');
                }
            });

            if (currentActive) {
                navLinks.forEach(link => link.classList.remove('active'));
                const activeLink = document.querySelector(`#toc a[href="#${currentActive}"]`);
                if (activeLink) activeLink.classList.add('active');
            } else {
                 if (mainContent.scrollTop < sections[0].offsetTop + sections[0].offsetHeight) {
                     navLinks.forEach(link => link.classList.remove('active'));
                     if (navLinks.length > 0) navLinks[0].classList.add('active');
                 }
            }
        };

        mainContent.addEventListener('scroll', updateActiveLink);
        setTimeout(updateActiveLink, 150);
    });
</script>

</body>
</html>